{# SPDX-FileCopyrightText: Â© 2015,2023 Siemens AG

   SPDX-License-Identifier: FSFAP
#}
{% set dualLicense = false %}
{% set textPrintedList = [] %}
{% if fileData.concludedLicenses|length > 2 %}
  {% for res in fileData.concludedLicenses %}
    {% if 'Dual-license' == licenseList[res].licenseObj.shortName %}
      {% set dualLicense = true %}
    {% endif %}
  {% endfor %}
{%- endif -%}
  <spdx:File rdf:about="https://spdx.org/rdf/3.0.0/terms/Software/File#SPDXRef-item{{ fileId }}">
    <spdx:spdxId>SPDXRef-item{{ fileId }}</spdx:spdxId>
    <spdx:creationInfo rdf:resource="https://spdx.org/rdf/3.0.0/terms/Core/creationInfo#creationInfo1"/>
    <spdx:name>{{ fileName }}</spdx:name>
    {% if licenseCommentState %}
    {% if fileData.comments is empty %}
    <spdx:comment>NOASSERTION</spdx:comment>
    {%~ else %}
    <spdx:comment><text>{{ fileData.comments|join('\n')|replace({'<text>':'&lt;text&gt;','</text>':'&lt;/text&gt;','\f':''}) }}</text></spdx:comment>
    {% endif %}
    {% endif %}
    {%~ if fileData.copyrights|default is empty %}
    <spdx:software_copyrightText rdf:resource="http://spdx.org/rdf/terms#noassertion" />
    {%~ else %}
    <spdx:software_copyrightText><![CDATA[
    {%~ for cp in fileData.copyrights %}
      {{ cp|replace({'\f':''})
           |replace({']]>':']]]]><![CDATA[>'}) }}
    {%~ endfor %}
    ]]></spdx:software_copyrightText>
    {%~ endif %}
    {% if fileData.acknowledgements|default is not empty %}
    <spdx:software_attributionText>&lt;text&gt;{{ fileData.acknowledgements|join('\n')|replace({'<text>':'&lt;text&gt;','</text>':'&lt;/text&gt;','\f':'','"':"'", '\n':''}) }}&lt;/text&gt;</spdx:software_attributionText>
    {% endif %}
    <spdx:verifiedUsing>
      <spdx:Hash>
        <spdx:algorithm>sha1</spdx:algorithm>
        <spdx:hashValue>{{ sha1 | lower }}</spdx:hashValue>
        <spdx:algorithm>sha256</spdx:algorithm>
        <spdx:hashValue>{{ sha256 | lower }}</spdx:hashValue>
        <spdx:algorithm>md5</spdx:algorithm>
        <spdx:hashValue>{{ md5 | lower }}</spdx:hashValue>
      </spdx:Hash>
    </spdx:verifiedUsing>
  </spdx:File>
{%~ if fileData.isCleared() %}
  {# File clearing decisions #}
  {%~ if fileData.concludedLicenses|default is empty %}
    <spdx:expandedlicensing_IndividualLicensingInfo rdf:about="https://spdx.org/rdf/3.0.0/terms/ExpandedLicensing/IndividualLicensingInfo">
      <spdx:spdxId rdf:resource="https://spdx.org/rdf/3.0.0/terms/Software/File/SPDXRef-item{{ fileId }}#NoneLicense"/>
      <spdx:creationInfo rdf:resource="https://spdx.org/rdf/3.0.0/terms/Core/creationInfo#creationInfo1"/>
    </spdx:expandedlicensing_IndividualLicensingInfo>
  {%~ elseif fileData.concludedLicenses|length > 1 %}
      {% if dualLicense %}
        <spdx:expandedlicensing_DisjunctiveLicenseSet rdf:about="https://spdx.org/rdf/3.0.0/terms/ExpandedLicensing/DisjunctiveLicenseSet">
      {% else %}
        <spdx:expandedlicensing_ConjunctiveLicenseSet rdf:about="https://spdx.org/rdf/3.0.0/terms/ExpandedLicensing/ConjunctiveLicenseSet">
      {% endif %} {# End dual license check #}
      <spdx:spdxId rdf:resource="https://spdx.org/rdf/3.0.0/terms/Software/File#SPDXRef-item{{ fileId }}"/>
      <spdx:creationInfo rdf:resource="https://spdx.org/rdf/3.0.0/terms/Core/creationInfo#creationInfo1"/>
      <spdx:expandedlicensing_member rdf:about="https://spdx.org/rdf/3.0.0/terms/ExpandedLicensing/member">
        {%~ for res in fileData.concludedLicenses %}
          {%~ if licenseList[res].licenseObj.spdxId starts with 'LicenseRef-' or licenseList[res].licenseObj.shortName starts with 'LicenseRef-' %}
            {%- set licId = licenseList[res].licenseObj.spdxId %}
            {% if licenseList[res].licenseObj.shortName starts with 'LicenseRef-' %}
              {% set licId = licenseList[res].licenseObj.shortName %}
            {%- endif %}
            <spdx:simplelicensing_AnyLicenseInfo rdf:about="https://spdx.org/rdf/3.0.0/terms/SimpleLicensing/AnyLicenseInfo">
              <spdx:creationInfo rdf:resource="https://spdx.org/rdf/3.0.0/terms/Core/creationInfo#creationInfo1"/>
              <spdx:spdxId rdf:resource="{{ uri }}#{{ licId|replace({' ': '-'})|url_encode }}"/>
            </spdx:simplelicensing_AnyLicenseInfo>
          {% else %}
            <spdx:simplelicensing_AnyLicenseInfo rdf:about="https://spdx.org/rdf/3.0.0/terms/SimpleLicensing/AnyLicenseInfo">
              <spdx:creationInfo rdf:resource="https://spdx.org/rdf/3.0.0/terms/Core/creationInfo#creationInfo1"/>
              <spdx:spdxId rdf:resource="{{ uri }}#{{ licenseList[res].licenseObj.spdxId|replace({' ': '-'})|url_encode }}"/>
              "name": "{{ licenseList[res].licenseObj.fullName|e }}"
            </spdx:simplelicensing_AnyLicenseInfo>
          {% endif %}
        {% endfor %}
      </spdx:expandedlicensing_member>
    {% if dualLicense %}
        </spdx:expandedlicensing_DisjunctiveLicenseSet>
      {% else %}
        </spdx:expandedlicensing_ConjunctiveLicenseSet>
      {% endif %} {# End dual license check #}
  {%~ elseif fileData.concludedLicenses|length == 1 %}
    {%- set res = fileData.concludedLicenses[0] %}
    {%- if licenseList[res].licenseObj.spdxId starts with 'LicenseRef-' or licenseList[res].licenseObj.shortName starts with 'LicenseRef-' %}
      {%- set licId = licenseList[res].licenseObj.spdxId %}
      {% if licenseList[res].licenseObj.shortName starts with 'LicenseRef-' %}
        {% set licId = licenseList[res].licenseObj.shortName %}
      {%- endif %}
      <spdx:simplelicensing_AnyLicenseInfo rdf:about="https://spdx.org/rdf/3.0.0/terms/SimpleLicensing/AnyLicenseInfo">
        <spdx:creationInfo rdf:resource="https://spdx.org/rdf/3.0.0/terms/Core/creationInfo#creationInfo1"/>
        <spdx:spdxId rdf:resource="https://spdx.org/rdf/3.0.0/terms/Software/File/SPDXRef-item{{ fileId }}#{{ licId|replace({' ': '-'})|url_encode }}"/>
      </spdx:simplelicensing_AnyLicenseInfo>
    {% else %}
      <spdx:simplelicensing_AnyLicenseInfo rdf:about="https://spdx.org/rdf/3.0.0/terms/SimpleLicensing/AnyLicenseInfo">
        <spdx:creationInfo rdf:resource="https://spdx.org/rdf/3.0.0/terms/Core/creationInfo#creationInfo1"/>
        <spdx:spdxId rdf:resource="https://spdx.org/rdf/3.0.0/terms/Software/File/SPDXRef-item{{ fileId }}#{{ licenseList[res].licenseObj.spdxId|replace({' ': '-'})|url_encode }}"/>
        <spdx:name>{{ licenseList[res].licenseObj.fullName|e }}</spdx:name>
      </spdx:simplelicensing_AnyLicenseInfo>
    {% endif %} 
  {%~ endif %}{# End printing single conclusion #}
  {%~ else %}
    {# No concluded licenses #}
    <spdx:expandedlicensing_IndividualLicensingInfo rdf:about="https://spdx.org/rdf/3.0.0/terms/ExpandedLicensing/IndividualLicensingInfo">
      <spdx:spdxId rdf:resource="https://spdx.org/rdf/3.0.0/terms/Software/File/SPDXRef-item{{ fileId }}#NoAssertionLicense"/>
      <spdx:creationInfo rdf:resource="https://spdx.org/rdf/3.0.0/terms/Core/creationInfo#creationInfo1"/>
    </spdx:expandedlicensing_IndividualLicensingInfo>
{% endif %}

